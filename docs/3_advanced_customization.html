

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Customization &mdash; dustpy  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Standard Model" href="4_standard_model.html" />
    <link rel="prev" title="Simple Customization" href="2_simple_customization.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> dustpy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_basics.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_simple_customization.html">Simple Customization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Customization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Customizing-the-Grids">Customizing the Grids</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#The-Radial-Grid">The Radial Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-Mass-Grid">The Mass Grid</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Customizing-the-Physics-of-a-Field">Customizing the Physics of a Field</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Adding-Custom-Fields">Adding Custom Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Modifying-the-Update-Order">Modifying the Update Order</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Systoles-and-Diastoles">Systoles and Diastoles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Customizing-the-Snapshots">Customizing the Snapshots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="4_standard_model.html">The Standard Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_dust_coagulation.html">Dust Coagulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_dust_evolution.html">Dust Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_gas_evolution.html">Gas Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_test_gas_evolution.html">Test: Gas Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="A_publications.html">Appendix A: List of Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Module Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">dustpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Advanced Customization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/3_advanced_customization.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Advanced-Customization">
<h1>Advanced Customization<a class="headerlink" href="#Advanced-Customization" title="Permalink to this headline">¶</a></h1>
<p>The core principle of <code class="docutils literal notranslate"><span class="pre">DustPy</span></code> is that you can change anything easily. Not only the initial conditions as shown in the previous chapter, but also the physics behind the simulation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dustpy</span> <span class="kn">import</span> <span class="n">Simulation</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="Customizing-the-Grids">
<h2>Customizing the Grids<a class="headerlink" href="#Customizing-the-Grids" title="Permalink to this headline">¶</a></h2>
<p>By default the radial and the mass grid will be created when calling <code class="docutils literal notranslate"><span class="pre">Simulation.initialize()</span></code>. But there can be situations where you need to know the grid sizes before completely initializing the Simulation object. For example if you want to create custom fields and you need to initialize them with the correct shape.</p>
<p>In that case you can call <code class="docutils literal notranslate"><span class="pre">Simulation.makegrids()</span></code> to only create the grids without initializing the simulation objects. In fact, <code class="docutils literal notranslate"><span class="pre">Simulation.makegrids()</span></code> is by default called within <code class="docutils literal notranslate"><span class="pre">Simulation.initialize()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Group (Grid quantities)
-----------------------
    m            : NoneType
    Nm           : NoneType
    Nr           : NoneType
    OmegaK       : NoneType
    r            : NoneType
    ri           : NoneType
  -----
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">makegrids</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Group (Grid quantities)
-----------------------
    m            : Field (Mass grid [g]), <span class="ansi-magenta-intense-fg">constant</span>
    Nm           : Field (# of mass bins), <span class="ansi-magenta-intense-fg">constant</span>
    Nr           : Field (# of radial grid cells), <span class="ansi-magenta-intense-fg">constant</span>
    r            : Field (Radial grid cell centers [cm]), <span class="ansi-magenta-intense-fg">constant</span>
    ri           : Field (Radial grid cell interfaces [cm]), <span class="ansi-magenta-intense-fg">constant</span>
  -----
    OmegaK       : NoneType
  -----
</pre></div></div>
</div>
<p>Note that the Keplerian frequency has not been initialized at this point.</p>
<div class="section" id="The-Radial-Grid">
<h3>The Radial Grid<a class="headerlink" href="#The-Radial-Grid" title="Permalink to this headline">¶</a></h3>
<p>By default the radial grid is a regular logarithmic grid. Meaning, the ratio of adjacent grid cells is constant.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931 1.07151931
 1.07151931 1.07151931 1.07151931]
</pre></div></div>
</div>
<div class="line-block">
<div class="line">As explained in the previous chapter, the location of the grid boundaries and the number of grid cells can be controlled via <code class="docutils literal notranslate"><span class="pre">Simulation.ini.grid.rmin</span></code>, <code class="docutils literal notranslate"><span class="pre">Simulation.ini.grid.rmax</span></code>, and <code class="docutils literal notranslate"><span class="pre">Simulation.ini.grid.Nr</span></code>.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Simulation.makegrids()</span></code> will use these parameters to create the radial grid.</div>
</div>
<p>But it is also possible to completely customize the grid. To do so you have to set the locations of the radial grid cell interfaces <code class="docutils literal notranslate"><span class="pre">Simulation.grid.ri</span></code> before calling either <code class="docutils literal notranslate"><span class="pre">Simulation.makegrids()</span></code> or <code class="docutils literal notranslate"><span class="pre">Simulation.initialize()</span></code>.</p>
<p>In this example we simply want to refine the grid at a given location. We use this helper function, which takes an existing grid <code class="docutils literal notranslate"><span class="pre">ri</span></code> and doubles the number of grid cells in a region <code class="docutils literal notranslate"><span class="pre">num</span></code> grid cells on both sides around location <code class="docutils literal notranslate"><span class="pre">r0</span></code>. We also recursively call this function with reduced <code class="docutils literal notranslate"><span class="pre">num</span></code> to even further refine the grid and to have a smooth transition between the high and low resolution regions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">refinegrid</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ri</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">r0</span> <span class="o">&gt;</span> <span class="n">ri</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">indl</span> <span class="o">=</span> <span class="n">ind</span><span class="o">-</span><span class="n">num</span>
    <span class="n">indr</span> <span class="o">=</span> <span class="n">ind</span><span class="o">+</span><span class="n">num</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">ril</span> <span class="o">=</span> <span class="n">ri</span><span class="p">[:</span><span class="n">indl</span><span class="p">]</span>
    <span class="n">rir</span> <span class="o">=</span> <span class="n">ri</span><span class="p">[</span><span class="n">indr</span><span class="p">:]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">rim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">ind</span><span class="o">-</span><span class="n">num</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ri</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">rim</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ri</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">ri</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ril</span><span class="p">,</span> <span class="n">rim</span><span class="p">,</span> <span class="n">rir</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">refinegrid</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We now create a regular logarithmic grid and feed it to our function. We want to refine the grid in a location around <span class="math notranslate nohighlight">\(4.5\,\mathrm{AU}\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">dustpy.constants</span> <span class="k">as</span> <span class="nn">c</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">au</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ri</span> <span class="o">=</span> <span class="n">refinegrid</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span> <span class="mf">4.5</span><span class="o">*</span><span class="n">c</span><span class="o">.</span><span class="n">au</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can now create a new empty Simulation object, assign the grid cell interfaces and initialize the grids.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ri</span> <span class="o">=</span> <span class="n">ri</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Group (Grid quantities)
-----------------------
    m            : NoneType
    Nm           : NoneType
    Nr           : NoneType
    OmegaK       : NoneType
    r            : NoneType
    ri           : ndarray
  -----
</pre></div></div>
</div>
<p><strong>Note:</strong> it is sufficient to assign a <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> to <code class="docutils literal notranslate"><span class="pre">Simulation.grid.ri</span></code> and not a <code class="docutils literal notranslate"><span class="pre">simframe.Field</span></code>.</p>
<p>We can now make the grids.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">makegrids</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Group (Grid quantities)
-----------------------
    m            : Field (Mass grid [g]), <span class="ansi-magenta-intense-fg">constant</span>
    Nm           : Field (# of mass bins), <span class="ansi-magenta-intense-fg">constant</span>
    Nr           : Field (# of radial grid cells), <span class="ansi-magenta-intense-fg">constant</span>
    r            : Field (Radial grid cell centers [cm]), <span class="ansi-magenta-intense-fg">constant</span>
    ri           : Field (Radial grid cell interfaces [cm]), <span class="ansi-magenta-intense-fg">constant</span>
  -----
    OmegaK       : NoneType
  -----
</pre></div></div>
</div>
<p>As you can see, <code class="docutils literal notranslate"><span class="pre">Simulation.grid.ri</span></code> was automatically converted to a <code class="docutils literal notranslate"><span class="pre">simframe.Field</span></code> and the other fields were created. The number of radial grid cells is greater than <span class="math notranslate nohighlight">\(100\)</span> as we added more grid cells.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">Nr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
114
</pre></div></div>
</div>
<p>To see that we actually refined the grid at the correct location, we can plot the location of the radial grid cells.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">r</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">au</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;# of radial grid cell&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Location of radial grid cell [AU]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/3_advanced_customization_26_0.png" src="_images/3_advanced_customization_26_0.png" />
</div>
</div>
<p>The position of the radial grid cells have to be exactly in the center between their grid cell interfaces and are automatically calculated by <code class="docutils literal notranslate"><span class="pre">Simulation.makegrids()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">r</span> <span class="o">==</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ri</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True  True  True  True  True  True  True
  True  True  True  True  True  True]
</pre></div></div>
</div>
</div>
<div class="section" id="The-Mass-Grid">
<h3>The Mass Grid<a class="headerlink" href="#The-Mass-Grid" title="Permalink to this headline">¶</a></h3>
<p>You should <strong>NEVER</strong> set the mass grid manually! The mass grid has to be strictly logarithmic. Only customize the mass grid by setting <code class="docutils literal notranslate"><span class="pre">Simulation.ini.grid.mmin</span></code>, <code class="docutils literal notranslate"><span class="pre">Simulation.ini.grid.mmax</span></code>, and <code class="docutils literal notranslate"><span class="pre">Simulation.ini.grid.Nmbpd</span></code>.</p>
<p>If you have to create your own non-logarithmic mass grid for some reason, be aware that you have to re-write the coagulation algorithms as well, since they only conserve mass on a logarithmic grid.</p>
</div>
</div>
<div class="section" id="Customizing-the-Physics-of-a-Field">
<h2>Customizing the Physics of a Field<a class="headerlink" href="#Customizing-the-Physics-of-a-Field" title="Permalink to this headline">¶</a></h2>
<p>In this example we want to have a fragmentation velocity that depends on the temperature in the disk. Is the temperature below 150 K, we want to have a fragmentation velocity of 10 m/s, otherwise it shall be 1 m/s. The idea behind this approach is than particles coated in water ice are stickier that pure silicate particles and can widthstand higher collision velocities. See for example <a class="reference external" href="https://doi.org/10.3847/1538-4357/aa7edb">Pinilla et al. (2017)</a>. However, keep in mind that newer
experiments suggest that particles covered in water ice do not have a beneficial collision behavior, see <a class="reference external" href="https://doi.org/10.3847/1538-4357/ab0428">Musiolik &amp; Wurm (2019)</a>.</p>
<p>First, we initialize our simulation object.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The fragmentation velocity has the shape <code class="docutils literal notranslate"><span class="pre">(Nr,)</span></code>, meaning there is one value at every location in the grid.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">frag</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(114,)
</pre></div></div>
</div>
<p>But right now it’s constant.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">r</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">au</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">frag</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Distance from star [AU]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Fragmentation velocity [cm/s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/3_advanced_customization_35_0.png" src="_images/3_advanced_customization_35_0.png" />
</div>
</div>
<p>We have to write a function that takes the simulation object as input parameter and returns our desired fragmentation velocities. We can use the fact that the gas temperature has the same shape. Keep in mind that everything has to be in cgs units.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(114,)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">v_frag</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">T</span><span class="o">&lt;</span><span class="mf">150.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can now assign this function to the updater of the dust fragmentation velocities. For details of this process, please have a look at the <a class="reference external" href="https://simframe.rtfd.io">Simframe documentation</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">frag</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="n">v_frag</span>
</pre></div>
</div>
</div>
<p>The updater of a group/field stores a <code class="docutils literal notranslate"><span class="pre">simframe.Heatbeat</span></code> object. When calling the <code class="docutils literal notranslate"><span class="pre">update()</span></code> function the heartbeat will be executed which consists of a <code class="docutils literal notranslate"><span class="pre">systole</span></code>, the actual <code class="docutils literal notranslate"><span class="pre">updater</span></code>, and a <code class="docutils literal notranslate"><span class="pre">diastole</span></code>. The <code class="docutils literal notranslate"><span class="pre">systole</span></code> is executed before the actual update functions, the <code class="docutils literal notranslate"><span class="pre">diastole</span></code> afterwards.</p>
<p>When assigning a function (or <code class="docutils literal notranslate"><span class="pre">None</span></code>) to the updater of a group/field a new <code class="docutils literal notranslate"><span class="pre">Heartbeat</span></code> object will be created with empty systoles and diastoles only executing the update function. If the existing updater already has systoles/diastoles, those would be overwritten with an empty function.</p>
<p>To prevent this you can directly assign the function only to the updater leaving the systoles/diastoles as they are.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">updater</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="n">v_frag</span>
</pre></div>
</div>
</div>
<p>The systoles/diastoles can be set with the following command. Only for demonstration, since we assign <code class="docutils literal notranslate"><span class="pre">None</span></code>. Read more about this in the section about Systoles and Diastoles.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">updater</span><span class="o">.</span><span class="n">systole</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">updater</span><span class="o">.</span><span class="n">diastole</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<p>As of now, the simulation object still holds the old data for the fragmentation velocity. We have to tell it to update itself. We can either update the whole simulation frame with <code class="docutils literal notranslate"><span class="pre">Simulation.update()</span></code>, or we just update the fragmentation velocities.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">frag</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The fragmentation velocities should now show our desired behavior.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">r</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">au</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">frag</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Distance from star [AU]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Fragmentation velocity [cm/s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/3_advanced_customization_48_0.png" src="_images/3_advanced_customization_48_0.png" />
</div>
</div>
<p><strong>Note:</strong> If you customized a quantity on which other quantities depend on, you also have to update these quantities. In our case this would be the sticking/fragmentation probabilites. So it is always better to update the whole simulation frame.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Adding-Custom-Fields">
<h2>Adding Custom Fields<a class="headerlink" href="#Adding-Custom-Fields" title="Permalink to this headline">¶</a></h2>
<p>We can not only modify existing fields, we can also create our own fields.</p>
<p>In this example we want to add another field <code class="docutils literal notranslate"><span class="pre">rsnow</span></code> to <code class="docutils literal notranslate"><span class="pre">Simulation.grid</span></code>, that gives us the location of the so called snowline, i.e., the location in the disk where water ice starts to sublime.</p>
<p>First, we add the field and initialize it with zero.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addfield</span><span class="p">(</span><span class="s2">&quot;rsnow&quot;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Snowline location [cm]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The grid group has now a new member.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Group (Grid quantities)
-----------------------
    m            : Field (Mass grid [g]), <span class="ansi-magenta-intense-fg">constant</span>
    Nm           : Field (# of mass bins), <span class="ansi-magenta-intense-fg">constant</span>
    Nr           : Field (# of radial grid cells), <span class="ansi-magenta-intense-fg">constant</span>
    OmegaK       : Field (Keplerian frequency [1/s])
    r            : Field (Radial grid cell centers [cm]), <span class="ansi-magenta-intense-fg">constant</span>
    ri           : Field (Radial grid cell interfaces [cm]), <span class="ansi-magenta-intense-fg">constant</span>
    rsnow        : Field (Snowline location [cm])
  -----
</pre></div></div>
</div>
<p>As a next step we have to write a function that returns us the location of the snowline. Here we simply use the first grid cell where the temperature is smaller than <span class="math notranslate nohighlight">\(150\,\mathrm{K}\)</span> and return the value of the inner interface of that grid cell.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">rsnow</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
    <span class="n">isnow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">T</span><span class="o">&lt;</span><span class="mf">150.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ri</span><span class="p">[</span><span class="n">isnow</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>We assign this function to the updater of our snowline field.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">rsnow</span><span class="o">.</span><span class="n">updater</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="n">rsnow</span>
</pre></div>
</div>
</div>
<p>And update the field.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">rsnow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The snowline is located at </span><span class="si">{:4.2f}</span><span class="s2"> AU.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">rsnow</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">au</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The snowline is located at 3.05 AU.
</pre></div></div>
</div>
<p>Right now the temperature is constant throughout the simulation, because the stellar parameters do not change. To see an effect in our snowline location, we need to have a changing temperature profile.</p>
<p>To achieve this, we let the stellar radius decrease from a value of <span class="math notranslate nohighlight">\(3\,M_\odot\)</span> to <span class="math notranslate nohighlight">\(2\,M_\odot\)</span> within the first <span class="math notranslate nohighlight">\(10,000\,\mathrm{yrs}\)</span>. This results in decreasing disk temperature. This is only for demonstration purposes and is not necessarily physical.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">Rstar</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
    <span class="n">dR</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="n">c</span><span class="o">.</span><span class="n">R_sun</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">1.e4</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">year</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">dR</span><span class="o">/</span><span class="n">dt</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">sim</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="mf">3.</span><span class="o">*</span><span class="n">c</span><span class="o">.</span><span class="n">R_sun</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">R_sun</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>
</pre></div>
</div>
</div>
<p>And assign this to the updater of the stellar radius.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">star</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">updater</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="n">Rstar</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Modifying-the-Update-Order">
<h2>Modifying the Update Order<a class="headerlink" href="#Modifying-the-Update-Order" title="Permalink to this headline">¶</a></h2>
<p>But we are still not done, yet. We have given <code class="docutils literal notranslate"><span class="pre">DustPy</span></code> instructions how to update the snowline location, but we have not yet told it to actually update it regularily.</p>
<p><code class="docutils literal notranslate"><span class="pre">DustPy</span></code> calls <code class="docutils literal notranslate"><span class="pre">Simulation.update()</span></code>, the updater of the simulation object, once per timestep after the integration step and just before writing the data files. The updater of a group/field is basically a list of groups/fields, whose updater is called in that order.</p>
<p>For the main simulation object this is</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;star&quot;</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;dust&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>This means that if you call <code class="docutils literal notranslate"><span class="pre">Simulation.update()</span></code> you basically call <code class="docutils literal notranslate"><span class="pre">Simulation.star.update()</span></code>, <code class="docutils literal notranslate"><span class="pre">Simulation.grid.update()</span></code>, <code class="docutils literal notranslate"><span class="pre">Simulation.gas.update()</span></code>, and <code class="docutils literal notranslate"><span class="pre">Simulation.dust.update()</span></code> in that order.</p>
<p>The updaters of the sub-groups and fields look as follows</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">star</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OmegaK&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;cs&quot;</span><span class="p">,</span> <span class="s2">&quot;Hp&quot;</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;mfp&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;eta&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="c1"># excluding [&quot;v&quot;, &quot;Fi&quot;]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="s2">&quot;tot&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;visc&quot;</span><span class="p">,</span> <span class="s2">&quot;rad&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="s2">&quot;rhos&quot;</span><span class="p">,</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;St&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;backreaction&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;eps&quot;</span><span class="p">,</span> <span class="s2">&quot;Fi&quot;</span><span class="p">,</span> <span class="s2">&quot;kernel&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">backreaction</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="s2">&quot;turb&quot;</span><span class="p">,</span> <span class="s2">&quot;vert&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">Fi</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;adv&quot;</span><span class="p">,</span> <span class="s2">&quot;diff&quot;</span><span class="p">,</span> <span class="s2">&quot;tot&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;frag&quot;</span><span class="p">,</span> <span class="s2">&quot;stick&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;coag&quot;</span><span class="p">,</span> <span class="s2">&quot;hyd&quot;</span><span class="p">,</span> <span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="s2">&quot;tot&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;frag&quot;</span><span class="p">,</span> <span class="s2">&quot;driftmax&quot;</span><span class="p">,</span> <span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="s2">&quot;rel&quot;</span><span class="p">]</span>
<span class="n">sim</span><span class="o">.</span><span class="n">dust</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">rel</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;azi&quot;</span><span class="p">,</span> <span class="s2">&quot;brown&quot;</span><span class="p">,</span> <span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="s2">&quot;turb&quot;</span><span class="p">,</span> <span class="s2">&quot;vert&quot;</span><span class="p">,</span> <span class="s2">&quot;tot&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p><strong>Note:</strong> The gas updater does not contain the updaters of <code class="docutils literal notranslate"><span class="pre">Simulation.gas.v</span></code> and <code class="docutils literal notranslate"><span class="pre">Simulation.gas.Fi</span></code> and the updater of the gas sources does not contain the updater of <code class="docutils literal notranslate"><span class="pre">Simulation.gas.S.hyd</span></code>. These are quantities that are calculated in the finalization step of the integrator, since they are derived from the result of the implicit gas integration.</p>
<p>As you can see, the grid updater is only updating the Keplerian frequency, but not our snowline location. So we can simply adding it to the list.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OmegaK&quot;</span><span class="p">,</span> <span class="s2">&quot;rsnow&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>If you assign lists to updaters the systoles and diastoles will always be overwritten with <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<div class="section" id="Systoles-and-Diastoles">
<h2>Systoles and Diastoles<a class="headerlink" href="#Systoles-and-Diastoles" title="Permalink to this headline">¶</a></h2>
<p>However, the previous solution has a conceptional problem. As you can see from the update order previously the grid is updated before the gas. The snowline location, however, needs the gas temperature and, therefore, has to be updated after the gas. But we also cannot update the grid as a whole after the gas, because the gas updaters need the Keplerian frequency. We need another solution.</p>
<p>But first, we revert the grid updater.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">updater</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OmegaK&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Every updater has a systole and a diastole. That is a function that is called before respectively after the actual updater. Since no other quantity depends on our snowline location, we can simply update it at the end and put it in the diastole of the main updater. Or we could assign it to the diastole of the gas temperature updater, since it only requires the updated gas temperature.</p>
<p>We therefore write a diastole function, that is updating the snowline location separately.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">diastole</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">rsnow</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>And assign this function to the diastole of the gas temperature updater.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">gas</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">updater</span><span class="o">.</span><span class="n">diastole</span> <span class="o">=</span> <span class="n">diastole</span>
</pre></div>
</div>
</div>
<p>Now every time <code class="docutils literal notranslate"><span class="pre">Simulation.gas.T.update()</span></code> is called, <code class="docutils literal notranslate"><span class="pre">Simulation.grid.rsnow.update()</span></code> will be called at the end of it.</p>
</div>
<div class="section" id="Customizing-the-Snapshots">
<h2>Customizing the Snapshots<a class="headerlink" href="#Customizing-the-Snapshots" title="Permalink to this headline">¶</a></h2>
<p>As already explained in a previous chapter, the snapshots can be customized by simply setting <code class="docutils literal notranslate"><span class="pre">Simulation.t.snapshots</span></code>. In this example we only want to run the simulation for <span class="math notranslate nohighlight">\(10,000\,\mathrm{yrs}\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">snapshots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
</div>
<p>We can now change the data directory to avoid an overwrite error and start the simulation with our modifications.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">datadir</span> <span class="o">=</span> <span class="s2">&quot;3_data&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

DustPy v0.4.2

Documentation: https://stammler.github.io/dustpy/
PyPI:          https://pypi.org/project/dustpy/
GitHub:        https://github.com/stammler/dustpy/

Please cite:   Stammler &amp; Birnstiel (in prep.)

<span class="ansi-yellow-intense-fg">Checking for mass conservation...
</span>
<span class="ansi-yellow-intense-fg">    - Sticking:</span>
        max. rel. error: <span class="ansi-green-intense-fg"> 2.81e-14</span>
        for particle collision
            m[114] =  1.93e+04 g    with
            m[116] =  3.73e+04 g
<span class="ansi-yellow-intense-fg">    - Full fragmentation:</span>
        max. rel. error: <span class="ansi-green-intense-fg"> 3.33e-16</span>
        for particle collision
            m[4] =  3.73e-12 g    with
            m[6] =  7.20e-12 g
<span class="ansi-yellow-intense-fg">    - Cratering:</span>
        max. rel. error: <span class="ansi-green-intense-fg"> 1.78e-15</span>
        for particle collision
            m[110] =  5.18e+03 g    with
            m[118] =  7.20e+04 g

Creating data directory &#39;3_data&#39;.
Writing file <span class="ansi-blue-intense-fg">3_data/data0000.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0001.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0002.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0003.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0004.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0005.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0006.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0007.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0008.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0009.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0010.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0011.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0012.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0013.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0014.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0015.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0016.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0017.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0018.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0019.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0020.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Writing file <span class="ansi-blue-intense-fg">3_data/data0021.hdf5</span>
Writing dump file <span class="ansi-blue-intense-fg">3_data/frame.dmp</span>
Execution time: <span class="ansi-blue-intense-fg">0:22:24</span>
</pre></div></div>
</div>
<p>We can now have a look at the result of our modifications.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dustpy</span> <span class="kn">import</span> <span class="n">plot</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot</span><span class="o">.</span><span class="n">panel</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/3_advanced_customization_92_0.png" src="_images/3_advanced_customization_92_0.png" />
</div>
</div>
<p>The change in fragmentation velocity has an obvious effect on the particles sizes.</p>
<p>To check the time evolution of the snowline, we have to read the data. The gray lines are the positions of the radial grid cell interfaces and snapshots, which explains the discrete behavior of the snowline location.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">rsnow</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">au</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ri</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">au</span><span class="p">,</span> <span class="mf">1.e3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">t</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.e3</span><span class="p">,</span> <span class="mf">1.e4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Snowline location [AU]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/3_advanced_customization_95_0.png" src="_images/3_advanced_customization_95_0.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="4_standard_model.html" class="btn btn-neutral float-right" title="The Standard Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="2_simple_customization.html" class="btn btn-neutral float-left" title="Simple Customization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Sebastian Stammler &amp; Til Birnstiel

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>